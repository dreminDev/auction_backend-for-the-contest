# auction_backend-for-the-contest

Backend система для проведения аукционов с поддержкой многораундовых ставок и автоматической выдачей подарков.

## Запуск

### Требования

- Docker и Docker Compose

### Настройка окружения

Создайте файл `.env` в корне проекта:

```env
DATABASE_URL=mongodb://dremin:2235@mongodb:27017/auction?authSource=admin
HTTP_SERVER_HOST=0.0.0.0
HTTP_SERVER_PORT=5000
ENV=production
MONGO_USER=dremin
MONGO_PASSWORD=2235
MONGO_DB=auction
MONGO_PORT=27017
```

### Запуск приложения

Запуск всех сервисов (MongoDB и приложение):

```bash
docker-compose up -d
```

Просмотр логов:

```bash
docker-compose logs -f app
```

Остановка:

```bash
docker-compose down
```

**Примечание:** Миграции применяются автоматически при первом запуске приложения через `bunx migrate-mongo up`.

## Реализованная функциональность

### Система аукционов

- Создание аукционов с настраиваемым количеством раундов
- Автоматическое распределение подарков по раундам
- Обработка окончания раундов через воркеры
- Переход проигравших ставок в следующий раунд
- Автоматический возврат баланса при завершении последнего раунда

### Система ставок

- Размещение ставок в текущем раунде
- Автоматическое продление раунда при ставках в последние 10 секунд
- Массовое обновление ставок при переходе в следующий раунд
- Массовый возврат баланса проигравшим участникам

### Система подарков

- Уникальная нумерация подарков (серийные номера)
- Массовая выдача подарков победителям раунда
- Проверка наличия подарков в коллекции
- Автоматическое распределение по раундам

### Система балансов

- Управление балансами пользователей
- Транзакционная обработка операций
- Логирование всех операций с балансом
- Поддержка различных типов балансов

### Антиснифинг

- Защита от манипуляций со ставками
- Валидация времени окончания раундов
- Транзакционная целостность операций
- Мьютексы для предотвращения гонок данных

### Архитектура

- Dependency Injection (DI) для управления зависимостями
- Разделение на слои: репозитории, сервисы, контроллеры
- Поддержка транзакций на уровне репозиториев
- Воркеры для фоновых задач
- Структурированное логирование

## Допущения которые были

- После создания ставки можно было возвращать ставки дабы улучшить синхронизированность между серверами
- По хорошему реализация должна быть выполнена была на вебсокетах для более быстрого реагирования на ставки

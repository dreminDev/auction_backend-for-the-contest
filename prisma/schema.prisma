generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  // url = env("DATABASE_URL")
}

model User {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int      @map("userId")

  username String?
  first_name String?
  last_name String?

  addedAt  DateTime @default(now()) @map("addedAt")

  @@map("users")
  @@index([userId])
}

enum BalanceType {
  stars
}
model Balance {
  id       String      @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int         @map("userId")
  type     BalanceType @map("type")
  balance  Int         @default(0) @map("balance")
  addedAt  DateTime    @default(now()) @map("addedAt")

  @@map("balances")
  @@index([userId])
}

enum AuctionStatus {
  active
  ended
}
model Auction {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  status   AuctionStatus @default(active) @map("status")

  roundCount Int @map("roundCount") 
  roundDuration Int @map("roundDuration") 

  roundStartTime DateTime @default(now()) @map("roundStartTime")
  roundEndTime DateTime @map("roundEndTime") 

  supplyCount Int @map("supplyCount")

  addedAt  DateTime @default(now()) @map("addedAt")
  endedAt  DateTime? @map("endedAt")

  @@index([addedAt, status])
  @@map("auctions")
}

model AuctionBet {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int        @map("userId")
  auctionId String     @map("auctionId") 
  amount Int @map("amount")
  addedAt  DateTime   @default(now()) @map("addedAt")
  metaData Json?      @default("{}") @map("metaData")

  @@map("auctionBets")
  @@index([userId, auctionId])
}

model Gift {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  ownerId   Int    @default(0)    @map("ownerId")

  

  updatedAt DateTime   @default(now()) @map("updatedAt")
  addedAt  DateTime   @default(now()) @map("addedAt")
  @@map("gifts")
}

enum ActionType {
  register
  balance
  bet
}
model Action {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int        @map("userId")
  action   ActionType @map("action")
  addedAt  DateTime   @default(now()) @map("addedAt")
  metaData Json?      @default("{}") @map("metaData")
  
  @@map("actions")
  @@index([userId])
}

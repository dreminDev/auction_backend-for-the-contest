generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url = env("DATABASE_URL")
}

model User {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int      @map("userId")

  username String?
  first_name String?
  last_name String?

  addedAt  DateTime @default(now()) @map("addedAt")

  @@map("users")
  @@index([userId])
}

enum BalanceType {
  stars
}
model Balance {
  id       String      @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int         @map("userId")
  type     BalanceType @map("type")
  balance  Int         @default(0) @map("balance")
  addedAt  DateTime    @default(now()) @map("addedAt")

  @@map("balances")
  @@index([userId])
}

enum AuctionStatus {
  active
  ended
}
model Auction {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  status   AuctionStatus @default(active) @map("status")

  roundCount Int @map("roundCount") 
  currentRound Int @default(1) @map("currentRound")
  roundDuration Int @map("roundDuration") 

  roundStartTime DateTime @default(now()) @map("roundStartTime")
  roundEndTime DateTime @map("roundEndTime") 

  giftCollectionId String @map("giftCollectionId")
  supplyCount Int @map("supplyCount")

  addedAt  DateTime @default(now()) @map("addedAt")
  endedAt  DateTime? @map("endedAt")

  @@index([addedAt, status])
  @@map("auctions")
}

model AuctionBet {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int        @map("userId")
  auctionId String     @map("auctionId") 
  amount Int @map("amount")
  round Int @map("round")
  addedAt  DateTime   @default(now()) @map("addedAt")
  metaData Json?      @default("{}") @map("metaData")

  @@map("auctionBets")
  @@index([userId, auctionId])
}

enum GiftType {
  plush_pepe
  plush_fox
}
model GiftCollection {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  collection GiftType @unique @map("collection")
  supplyCount Int @map("supplyCount")
  addedAt  DateTime   @default(now()) @map("addedAt")
  @@map("gift_collections")
}

model GiftOwner {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  giftId String @map("giftId")

  ownerId Int @map("ownerId")
  serialNumber Int @map("serialNumber")

  addedAt  DateTime   @default(now()) @map("addedAt")
  @@map("gift_owners")
  @@index([ownerId, giftId])
}

enum ActionType {
  register
  balance
  bet
}
model Action {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  userId   Int        @map("userId")
  action   ActionType @map("action")
  addedAt  DateTime   @default(now()) @map("addedAt")
  metaData Json?      @default("{}") @map("metaData")
  
  @@map("actions")
  @@index([userId])
}
